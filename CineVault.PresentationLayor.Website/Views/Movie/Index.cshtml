@model IEnumerable<CineVault.ModelLayer.ModelMovie.Movie>

@{
	ViewData["Title"] = "Index";
}

<h1 class="title-colored">Overzicht</h1>

<input type="text" id="searchInput" placeholder="Zoek..." class="form-control mb-3" /> <!-- Zoekveld waarin gebruiker tekst kan typen om te filteren -->
<p id="noResultsMessage" style="display:none; color:red;">Geen resultaten gevonden.</p><!-- Verborgen paragraaf die getoond wordt als er geen resultaten zijn -->
@if (!Model.Any())
{
    <div class="alert alert-info">
        @{
            var path = Context.Request.Path.ToString().ToLower();
            if (path.Contains("allseenmovies"))
            {
                <p>Je hebt nog geen enkele film gezien of als 'gezien' gemarkeerd.</p>
            }
            else if (path.Contains("allunseenmovies"))
            {
                <p>Alle films zijn al bekeken! Geen ongeziene films meer.</p>
            }
            else
            {
                <p>Er zijn momenteel geen films om weer te geven.</p>
            }
        }
    </div>
}
else
{
    <table class="table" style="background-color: beige; color: black; border-radius: 10px; padding: 10px;">
        <thead>
            <tr>
                <th>@Html.DisplayNameFor(model => model.Title)</th>
                <th>@Html.DisplayNameFor(model => model.Seen)</th>
                <th>@Html.DisplayNameFor(model => model.Score)</th>
                <th>@Html.DisplayNameFor(model => model.Year)</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        <a asp-action="Details" asp-route-id="@item.Id" class="klick-link">
                            @Html.DisplayFor(modelItem => item.Title)
                        </a>
                    </td>
                    <td>@Html.DisplayFor(modelItem => item.Seen)</td>
                    <td>@Html.DisplayFor(modelItem => item.Score)</td>
                    <td>@Html.DisplayFor(modelItem => item.Year)</td>
                    <td>
                        <a href="#" class="toggle-seen btn btn-sm btn-warning me-1" data-id="@item.Id">Gezien of niet gezien</a>
                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger" onclick="return confirm('Weet je zeker dat je deze film wilt verwijderen?');">Verwijder film</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}


@*script is nodig om javascript in te laden*@
<script>

	$(document).ready(function() {
		// Wacht tot de volledige pagina is geladen voordat het script wordt uitgevoerd
		$(".toggle-seen").click(function(event) {

			event.preventDefault(); // Voorkomt dat de standaard linkactie wordt uitgevoerd

			let movieId = $(this).data("id"); // Haalt het ID van de film op uit het data-attribuut van de klikbare link

			// Start een AJAX-aanroep om de "Gezien" status van de film te wijzigen
			$.ajax({
				url: "/Movie/ToggleSeen", // Backend-endpoint dat de status van de film aanpast in de database
				type: "POST", // Verzendt een POST-verzoek naar de server
				data: { id: movieId }, // Stuurt het film-ID mee als request-data

				success: function(response) {
					location.reload(); // Vernieuwt de pagina om de bijgewerkte status zichtbaar te maken
				},

				error: function() {
					alert("Something went wrong!"); // Toont een foutmelding als de aanvraag mislukt
				}
			});
		});
	});
</script>


<script>
	$(document).ready(function () { // Zorgt ervoor dat dit script pas werkt nadat de volledige HTML is ingeladen

		$("#searchInput").on("keyup", function () { // Voer deze functie uit telkens de gebruiker een toets loslaat in het zoekveld
			let value = $(this).val().toLowerCase(); // Haal de huidige waarde van het zoekveld op en zet die om naar kleine letters
			const rows = $("table tbody tr"); // Selecteer alle rijen in de <tbody> van de tabel
			let visibleRows = 0; // Tel hoeveel rijen zichtbaar blijven na filtering

			rows.each(function () { // Voor elke rij in de tabel:
				let isVisible = $(this).text().toLowerCase().indexOf(value) > -1; // Bepaal of de rij de zoekterm bevat
				$(this).toggle(isVisible); // Verberg of toon de rij op basis van of hij de zoekterm bevat
				if (isVisible) visibleRows++; // Verhoog de teller als de rij zichtbaar is
			});

			if (visibleRows === 0) { // Toon of verberg de melding afhankelijk van of er zichtbare rijen zijn
				$("#noResultsMessage").show();  // Toon melding
			} else {
				$("#noResultsMessage").hide();  // Verberg melding
			}
		});
	});
</script>
