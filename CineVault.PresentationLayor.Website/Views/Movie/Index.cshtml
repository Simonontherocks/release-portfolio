@model IEnumerable<CineVault.ModelLayer.ModelMovie.Movie>

@{
    ViewData["Title"] = "Index";
}

<h1 class="title-colored">Overzicht</h1>

<input type="text" id="searchInput" placeholder="Zoek..." class="form-control mb-3" /> <!-- Zoekveld waarin gebruiker tekst kan typen om te filteren -->
<p id="noResultsMessage" style="display:none; color:red;">Geen resultaten gevonden.</p><!-- Verborgen paragraaf die getoond wordt als er geen resultaten zijn -->
@if (!Model.Any())
{
    <div class="alert alert-info">
        @{
            var path = Context.Request.Path.ToString().ToLower();
            if (path.Contains("allseenmovies"))
            {
                <p>Je hebt nog geen enkele film gezien of als 'gezien' gemarkeerd.</p>
            }
            else if (path.Contains("allunseenmovies"))
            {
                <p>Alle films zijn al bekeken! Geen ongeziene films meer.</p>
            }
            else
            {
                <p>Er zijn momenteel geen films om weer te geven.</p>
            }
        }
    </div>
}
else
{
    <table id="movieTable" class="table" style="background-color: beige; color: black; border-radius: 10px; padding: 10px;">
        <!-- id toegevoegd zodat we de tabel kunnen verbergen bij geen resultaten -->
        <thead>
            <tr>
                <th>@Html.DisplayNameFor(model => model.Title)</th>
                <th>@Html.DisplayNameFor(model => model.Seen)</th>
                <th>@Html.DisplayNameFor(model => model.Score)</th>
                <th>@Html.DisplayNameFor(model => model.Year)</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        <a asp-action="Details" asp-route-id="@item.Id" class="klick-link">
                            @Html.DisplayFor(modelItem => item.Title)
                        </a>
                    </td>
                    <td>@Html.DisplayFor(modelItem => item.Seen)</td>
                    <td>@Html.DisplayFor(modelItem => item.Score)</td>
                    <td>@Html.DisplayFor(modelItem => item.Year)</td>
                    <td>
                        <a href="#" class="toggle-seen btn btn-sm btn-warning me-1" data-id="@item.Id">Gezien of niet gezien</a>
                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger" onclick="return confirm('Weet je zeker dat je deze film wilt verwijderen?');">Verwijder film</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}


@*script is nodig om javascript in te laden*@
<script>

    $(document).ready(function() {
        $(".toggle-seen").click(function(event) {
            event.preventDefault(); // Voorkomt dat de standaard linkactie wordt uitgevoerd
            let movieId = $(this).data("id"); // Haalt het ID van de film op

            $.ajax({
                url: "/Movie/ToggleSeen", // Endpoint dat de status aanpast
                type: "POST", // POST-verzoek
                data: { id: movieId }, // Film-ID meesturen
                success: function(response) {
                    location.reload(); // Pagina verversen bij succes
                },
                error: function() {
                    alert("Something went wrong!"); // Foutmelding bij falen
                }
            });
        });
    });
</script>

<script>
    $(document).ready(function () {
        $("#searchInput").on("keyup", function () {
            let value = $(this).val().toLowerCase(); // Zoekterm ophalen
            const rows = $("table tbody tr"); // Alle rijen ophalen
            let visibleRows = 0; // Teller voor zichtbare rijen

            rows.each(function () {
                let isVisible = $(this).text().toLowerCase().indexOf(value) > -1; // Check of rij zoekterm bevat
                $(this).toggle(isVisible); // Toon/verberg rij
                if (isVisible) visibleRows++; // Tel zichtbare rijen
            });

            if (visibleRows === 0) {
                $("#noResultsMessage").show(); // Toon melding bij 0 resultaten
                $("#movieTable").hide(); // Verberg hele tabel incl. header
            } else {
                $("#noResultsMessage").hide(); // Verberg melding
                $("#movieTable").show(); // Toon tabel terug
            }
        });
    });
</script>
